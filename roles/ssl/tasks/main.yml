---


- name: system packages | install openssl
  yum:
    name: "{{ item }}"
    state: latest

  with_items:
    - openssl 
    - python-pip

- name: install pip package
  pip:
    name: pyOpenSSL
 
- name: Create directory
 
  file:
 
    path: "{{ item }}"
 
    state: directory
 
    mode: 0755
  with_items:
    - /etc/ssl/private/
    - /etc/ssl/csr
 
- name: Generate an OpenSSL private key

  openssl_privatekey:

    path: /etc/ssl/private/ansible.com.pem

- name: Generate an OpenSSL Certificate Signing Request
 
  openssl_csr:
 
    path: /etc/ssl/csr/www.ansible.com.csr
 
    privatekey_path: /etc/ssl/private/ansible.com.pem
 
    country_name: IN
 
    organization_name: Ansible
 
    email_address: author@shakthimaan.com
 
    common_name: www.ansible.com
 
- name: Generate a self signed certificate
 
  openssl_certificate:
 
    path: /etc/ssl/certs/nginx-selfsigned.crt
 
    privatekey_path: /etc/ssl/private/ansible.com.pem
 
    csr_path: /etc/ssl/csr/www.ansible.com.csr
 
    provider: selfsigned
